#!/bin/sh

if ! command -v scrot &> /dev/null; then
	notify-send "Locking error" "scrot is not installed!" -u critical
	3lock
	exit
fi

if ! command -v convert &> /dev/null; then
	notify-send "Locking error" "imagemagick is not installed!" -u critical
	i3lock
	exit
fi

image="/tmp/scr.png"
icon="$HOME/.local/bin/res/lock_icon.png"
text="Type password to unlock"

scrot $image

convert "$image" -blur 0x5 -font "FreeSans" -pointsize 26 \
	-gravity center -annotate +0+160 "$text" \
	"$icon" -gravity center -composite "$image"

i3lock -i "$image"

rm -f "$image"
